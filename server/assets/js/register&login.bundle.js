(self.webpackChunk=self.webpackChunk||[]).push([[66],{22717:e=>{var n={VALIDATE:{USER_ERRNO:123456,USER:function(e){return{errno:n.VALIDATE.USER_ERRNO,msg:e}}},CACHE:{UPDATE:{NO_DATA:function(e){return{errno:50002,msg:"更新 cache/".concat(e," 卻沒提供參數")}}},READ:{NO_DATA:function(e){return{errno:50002,msg:"撈取 cache/".concat(e," 卻沒提供參數")}}}},MSG_RECEIVER:{UPDATE:{ERR:{errno:801,msg:"更新 MsgReceiver 失敗"},CONFIRM:{errno:1003,msg:"confirm msgReceiver 失敗"},ROW:{errno:1401,msg:"bulkCreate MsgReceiver 的數量不完全"}},DELETE:{ROW:{errno:40003,msg:"刪除 MsgReceiver 的數量不完全"},ERR:{errno:801,msg:"刪除 MsgReceiver 失敗"}},CREATE:{ROW:{errno:40005,msg:"創建 MsgReceiver 的數量不完全"},NO_DATA:{errno:50002,msg:"創建 MsgReceiver 卻沒提供參數"},ERR:{errno:50001,msg:"MsgReceiver 創建失敗"}},READ:{SHOULD_NOT_EXIST:{errno:50003,msg:"出現不該存在的 MsgReceiver"},NOT_EXIST:{errno:50003,msg:"不存在任何相符的 MsgReceiver"}}},ARTICLE_READER:{UPDATE:{ERR:{errno:801,msg:"更新 ArticleReader 失敗"},CONFIRM:{errno:1003,msg:"confirm articleReader 失敗"},ROW:{errno:10004,msg:" ArticleReader 更新結果的數量不完全"}},DELETE:{ERR:{errno:801,msg:"刪除 ArticleReader 失敗"},ROW:{errno:40003,msg:"刪除 ArticleReader 的數量不完全"}},CREATE:{NO_DATA:{errno:50002,msg:"創建 ArticleReader 卻沒提供參數"},ROW:{errno:40005,msg:"創建 ArticleReader 的數量不完全"},ERR:{errno:40005,msg:"ArticleReader 創建失敗"}},RESTORE:{ROW:{errno:40004,msg:"恢復軟刪除 ArticleReader 的數量不完全"}}},IDOL_FANS:{CREATE:{ROW:{errno:40001,msg:"IdolFans 創建數量不完全"}},UPDATE:{CONFIRM:{errno:1003,msg:"confirm IdolFans 失敗"},ERR:{errno:801,msg:"更新 IdolFans 失敗"}},RESTORE:{ROW:{errno:40004,msg:"恢復軟刪除 IdolFans 的數量不完全"}},DELETE:{ERR:{errno:801,msg:"刪除 IdolFans 失敗"},ROW:{errno:40003,msg:"刪除 IdolFans 的數量不完全"},NO_IDOL:{errno:40002,msg:"要刪除的 Idol 不存在"}}},COMMENT:{DELETE:{NOT_DATA:{errno:50002,msg:"刪除 COMMENT 卻沒提供參數"},ERR:{errno:801,msg:"刪除 COMMENT 失敗"},ROW:{errno:40003,msg:"刪除 BLOG 的數量不完全"}},READ:{NOT_EXIST:{errno:50003,msg:"不存在任何相符的 Comment"}},CREATE_ERR:{errno:1103,msg:"COMMENT 創建失敗"},NOT_EXIST:{errno:1102,msg:"評論不存在"},REMOVE_ERR:{errno:1101,msg:"文章刪除失敗"}},BLOG_IMG_ALT:{UPDATE:{errno:902,msg:"BLOG_IMG_ALT 更新失敗"},READ:{NO_DATA:{errno:50002,msg:"查詢 BLOG_IMG_ALT 卻沒提供參數"},NOT_EXIST:{errno:50003,msg:"不存在任何相符的 BlogImgAlt"}},DELETE:{ERR:{errno:801,msg:"刪除 BlogImgAlt 失敗"},ROW:{errno:40003,msg:"刪除 BlogImgAlt 的數量不完全"}},CREATE:{NO_DATA:{errno:50002,msg:"創建 BLOG_IMG_ALT 卻沒提供參數"},ERR:{errno:50001,msg:"BlogImgAlt創建失敗"}},REMOVE_ERR:{errno:903,msg:"BlogImgAlt刪除失敗"}},BLOG:{DELETE:{ROW:{errno:40003,msg:"刪除 BLOG 的數量不完全"},ERR:{errno:801,msg:"刪除 BLOG 失敗"}},REMOVE:{NO_DATA:{errno:30001,msg:"刪除 BLOG 卻沒提供查詢參數"},ERR:{errno:706,msg:"刪除Blog失敗"}},UPDATE:{errno:30004,msg:"BLOG資料更新失敗"},CREATE:{errno:30003,msg:"BLOG 創建失敗"},READ:{NOT_EXIST:{errno:30002,msg:"BLOG不存在"},NO_DATA:{errno:30001,msg:"查詢 BLOG 卻沒提供查詢參數"}},UPLOAD_IMG_ERR:{errno:704,msg:"Blog內文圖片上傳失敗"},IMAGE_REMOVE_ERR:{errno:705,msg:"刪除BlogImg時，數量對不上"}},BLOG_IMG:{READ:{NOT_EXIST:{errno:1111,msg:"沒有相符的 BlogImg"}},CREATE:{NO_DATA:{errno:50002,msg:"創建 BLOG_IMG 卻沒提供參數"},ERR:{errno:50001,msg:"BlogImg創建失敗"}},DELETE:{ERR:{errno:801,msg:"刪除 BlogImg 失敗"},ROW:{errno:40003,msg:"刪除 BlogImg 的數量不完全"}},UPDATE_ERR:{errno:802,msg:"更新失敗"},CREATE_ERR:{errno:803,msg:"創建失敗"}},IMG:{CREATE:{NO_DATA:{errno:50002,msg:"創建 IMG 卻沒提供參數"},ERR:{errno:50001,msg:"IMG 創建失敗"}},NO_DATA:{errno:40001,msg:"沒有相符的 IMG"}},PERMISSION:{NOT_OWNER:{errno:200002,msg:"非擁有者"},NO_LOGIN:{errno:111111,msg:"尚未登入"},NOT_SELF:{errno:502,msg:"非本人"}},USER:{READ:{FIRST_FOLLOW:{errno:12003,msg:"第一次跟隨此 idol，沒有軟刪除 idolFans 紀錄"},NO_USER:{errno:12002,msg:"找不到 USER"},NO_DATA:{errno:12001,msg:"USER 無相關數據"}},LOGIN:{NO_USER:{errno:11002,msg:"查無此人，email或password有誤"},DATA_INCOMPLETE:{errno:11001,msg:"未提供email或password"}},REGISTER:{CREATE:{errno:10004,msg:"USER 創建失敗"},NO_PASSWORD:{errno:10003,msg:"密碼未填"},NO_EMAIL:{errno:10002,msg:"信箱未填"},IS_EXIST:{errno:10001,msg:"此信箱已被登記"}}},NEWS:{FOLLOW_CONFIRM_ERR:{errno:1101,msg:"Follow.confirm 更新失敗"},BLOG_FANS_CONFIRM_ERR:{errno:1102,msg:"Blog_Fans.confirm 更新失敗"},FOLLOW_COMMENT_CONFIRM_ERR:{errno:1103,msg:"Blog_Fans.confirm 更新失敗"}},READ:{NOT_EXIST:{errno:201,msg:"沒有相符的使用者資料"}},UPDATE:{NO_DATA:{errno:333,msg:"更新 User Data 卻沒提供數據"},INVALICATE:{errno:301},UNEXPECTED:{errno:399},VALICATE_ERR:{errno:302},NO_THIS_ONE:{errno:303,msg:"沒有這個人"},AVATAR_FORMAT_ERR:{errno:304,msg:"avatar圖檔格式錯誤，只接受JPG或PNG"},NO_EXT:{errno:305,msg:"少了ext數據"},NO_HASH:{errno:305,msg:"少了hash數據"},FORMIDABLE_ERR:{errno:306,msg:"formidable 解析發生錯誤"},UPDATE_GCE_ERR:{errno:307,msg:"upload file to GCS 發生錯誤"}},FORMAT_ERR:{errno:601},PUB_SUB:{REMOVE_ERR:{errno:1101,msg:"PUB_SUB 刪除失敗"}},SERVER_ERR:{errno:9999,msg:"伺服器錯誤"}};e.exports=n},46997:(e,n,r)=>{"use strict";var t=r(74846),a=r.n(t),o=r(68270),s=r.n(o),i=r(44315),c=r.n(i),l=r(17876),u=r.n(l),d=r(90837),f=r.n(d),m=r(59129),p=r(86806),g=r(66584),h=r.n(g),v=r(70846),w=r.n(v),E=r(23598),R=r.n(E),b=r(2729),y=r.n(b),A=r(69845),x=r.n(A),O=r(31295),_=r.n(O),I=r(50623),T=r(1489),L=r(5007),k=r.n(L),D=r(65638);console.log("@commonUI loading...");var S="loadingBackdrop",M="noClick",N=function(){function e(){var n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#".concat(S);(0,I.Z)(this,e),this.$backdrop=D(r).first(),this.$blockList=D("input, a, button, *[tabindex]:not(#pageLoading)"),this.$backdrop.on("focus",(function(e){e.preventDefault(),n.$backdrop.blur()}))}return(0,T.Z)(e,[{key:"hidden",value:function(){this.$blockList.removeClass(M).off(".".concat(S)),this.$backdrop.removeAttr("style").hide()}},{key:"show",value:function(){var e=this;this.$backdrop.show(),this.$blockList.addClass(M).on("focus.".concat(S),(function(n){return e.focusBackdrop(n)}))}},{key:"focusBackdrop",value:function(e){e.preventDefault(),this.$backdrop.focus()}}]),e}(),$=r(10414),C=r.n($),j=r(66524),P=r.n(j);console.log("@genDebounce loading...");var Z={ms:250,auto:!1,loading:void 0};function G(e){var n,r=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z,a=t.ms,o=void 0===a?Z.ms:a,s=t.auto,i=void 0===s?Z.auto:s,c=t.loading,l=void 0===c?Z.loading:c;return function t(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];var u;l&&l.call.apply(l,C()(u=[r]).call(u,s)),n&&clearTimeout(n),n=P()((0,p.Z)(h().mark((function n(){var r;return h().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.call.apply(e,C()(r=[this]).call(r,s));case 2:i&&t(e,o);case 3:case"end":return n.stop()}}),n,this)}))),o)}}var U=r(1005),B=r(58837),F=r.n(B),V=r(21530),W=r.n(V),q=r(38414),X=r.n(q),H=r(59588),J=r.n(H),K=r(23356),z=r.n(K),Q=r(14206),Y=r.n(Q),ee=r(22717);console.log("@_axios loading.....");var ne=new N;Y().interceptors.request.use((function(e){return ne.show(),e}),(function(e){throw e})),Y().interceptors.response.use((function(e){e.config.url;var n=e.data,r=n.errno,t=(n.data,n.msg,e.data);return r===ee.PERMISSION.NO_LOGIN.errno&&(t={errno:r,data:{me:{}}}),ne.hidden(),z().resolve(t)}),(function(e){return function(e){console.log("@_axios error => ",e);var n,r,t=e.response.data,a=t.errno,o=t.msg;return n=a===ee.PERMISSION.NO_LOGIN.errno?"/login?from=".concat(encodeURIComponent(location.href)):C()(r="/errPage?errno=".concat(encodeURIComponent(a),"&msg=")).call(r,encodeURIComponent(o)),alert(o),location.href=n,z().reject()}(e)}));const re=Y();var te,ae;function oe(e,n){var r=void 0!==c()&&u()(e)||e["@@iterator"];if(!r){if(f()(e)||(r=function(e,n){var r;if(e){if("string"==typeof e)return se(e,n);var t=a()(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?s()(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?se(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){d=!0,i=e},f:function(){try{l||null==r.return||r.return()}finally{if(d)throw i}}}}function se(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}console.log("@validate loading...");var ie=new(W())({strict:!1,allErrors:!0,$data:!0});X()(ie),J()(ie),ie.addKeyword({keyword:"isEmailExist",async:!0,type:"string",schemaType:"boolean",validate:function(e,n,r,t){return fe.apply(this,arguments)},errors:!0}),ie.addKeyword({keyword:"diff",$data:!0,type:["string","number"],schemaType:["string","number","null"],validate:function e(n,r,t,a){if(console.log("@schema => ",n),console.log("@data => ",r),console.log("@parentSchema => ",t),console.log("@dataCtx => ",a),n!==r||!n)return!0;var o=a.instancePath;return e.errors=[{instancePath:o,message:"與原資料相同"}],!1},errors:!0}),ie.addKeyword({keyword:"confirmPassword",type:"string",async:!0,schemaType:"boolean",validate:function(e,n,r,t){return de.apply(this,arguments)},errors:!0}),ie.addKeyword({keyword:"noSpace",type:"string",schemaType:"boolean",validate:function e(n,r,t,a){if(!n)return!0;if(/\s/g.test(r)){var o=a.instancePath;return e.errors=[{instancePath:o,message:"不可包含空格"}],!1}return!0},errors:!0});var ce={URL:"http://my.ajv.schema",VALIDATE:{DEFS:"defs",EMAIL:"email",REGISTER:"register",LOGIN:"login",PASSWORD:"password",AVATAR:"avatar",SETTING:"setting"},API:{EMAIL:"/api/user/isEmailExist",PASSWORD:"/api/user/confirmPassword"}},le=(te={},(0,U.Z)(te,ce.VALIDATE.DEFS,{$id:"".concat(ce.URL,"/defs.json"),definitions:{email:{type:"string",format:"email",errorMessage:{type:"必須是字符串",format:"必須是電子信箱格式"}},nickname:{type:"string",pattern:"^[\\u4e00-\\u9fa5a-zA-Z\\d]+$",maxLength:20,errorMessage:{type:"必須是字符串",pattern:"必須由英文、數字以及底線組成",maxLength:"長度需小於20個字"}},origin_password:{type:"string",pattern:"^[\\w]+$",minLength:6,maxLength:32,errorMessage:{type:"必須是字符串",pattern:"必須由英文、數字以及底線組成",minLength:"長度須介於6-32個字符",maxLength:"長度須介於6-32個字符"}},password:{type:"string",pattern:"^[\\w]+$",minLength:6,maxLength:32,errorMessage:{type:"必須是字符串",pattern:"必須由英文、數字以及底線組成",minLength:"長度須介於6-32個字符",maxLength:"長度須介於6-32個字符"}},password_again:{type:"string",const:{$data:"1/password"},pattern:"^[\\w]+$",minLength:6,maxLength:32,errorMessage:{type:"必須是字符串",const:"請再次確認密碼是否相同",pattern:"必須由英文、數字以及底線組成",minLength:"長度須介於6-32個字符",maxLength:"長度須介於6-32個字符"}},age:{type:"number",minimum:1,maximum:120,errorMessage:{type:"必須是數字",minimum:"必需介於1-120之間",maximum:"必需介於1-120之間"}},avatar:{type:"string",format:"binary",errorMessage:{type:"必須是string",format:"頭像資料需符合url格式"}},avatar_hash:{type:"string",errorMessage:"avatar_hash必須是字符串"}}}),(0,U.Z)(te,ce.VALIDATE.EMAIL,{$id:"".concat(ce.URL,"/email.json"),$async:!0,type:"object",if:{properties:{email:{$ref:"defs.json#/definitions/email"}},required:["email"]},then:{properties:{email:{type:"string",isEmailExist:!0}}},else:{$ref:"#/if"},errorMessage:{required:"必填"}}),(0,U.Z)(te,ce.VALIDATE.REGISTER,{$id:"".concat(ce.URL,"/register.json"),type:"object",properties:{email:{$ref:"defs.json#/definitions/email"},password:{$ref:"defs.json#/definitions/password"},password_again:{$ref:"defs.json#/definitions/password_again"}},required:["email","password","password_again"],errorMessage:{required:"必填"}}),(0,U.Z)(te,ce.VALIDATE.LOGIN,{$id:"".concat(ce.URL,"/login.json"),type:"object",properties:{email:{$ref:"defs.json#/definitions/email"},password:{$ref:"defs.json#/definitions/password"}},required:["email","password"],errorMessage:{required:"必填"}}),(0,U.Z)(te,ce.VALIDATE.PASSWORD,{$id:"".concat(ce.URL,"/password.json"),$async:!0,type:"object",if:{properties:{origin_password:{$ref:"defs.json#/definitions/password"}},required:["origin_password"]},then:{properties:{origin_password:{confirmPassword:!0}},required:["origin_password"]},else:{$ref:"#/if"},errorMessage:{required:"必填"}}),(0,U.Z)(te,ce.VALIDATE.AVATAR,{$id:"".concat(ce.URL,"/avatar.json"),type:"object",properties:{avatar_base64:{format:"byte",errorMessage:{format:"非base64編碼"}},avatar_hash:{diff:{$data:"1/$$me/avatar_hash"},$ref:"defs.json#/definitions/avatar_hash"}},required:["avatar_base64","avatar_hash"],errorMessage:{required:"必填"}}),(0,U.Z)(te,ce.VALIDATE.SETTING,{$id:"".concat(ce.URL,"/setting.json"),type:"object",allOf:[{minProperties:2,properties:{$$me:{type:"object",errorMessage:{type:"$$me需是object"}},email:{noSpace:!0,diff:{$data:"1/$$me/email"},$ref:"defs.json#/definitions/email"},age:{noSpace:!0,diff:{$data:"1/$$me/age"},$ref:"defs.json#/definitions/age"},nickname:{noSpace:!0,diff:{$data:"1/$$me/nickname"},$ref:"defs.json#/definitions/nickname"},password:{noSpace:!0,diff:{$data:"1/$$me/password"},$ref:"defs.json#/definitions/password"},avatar_hash:{diff:{$data:"1/$$me/avatar_hash"},$ref:"defs.json#/definitions/avatar_hash"}},required:["$$me"],errorMessage:{required:"必需有值",minProperties:"至少需改一筆資料"}},{properties:{password:{$ref:"defs.json#/definitions/password",diff:{$data:"1/$$me/origin_password"}},password_again:{$ref:"defs.json#/definitions/password_again"}},dependentRequired:{password:["password_again","origin_password"],password_again:["password","origin_password"]},errorMessage:{dependentRequired:"必填"}}],errorMessage:{type:"驗證數據必須是 object 格式"}}),te);function ue(e){var n=ie.compile(le[e]);return function(){var e=(0,p.Z)(h().mark((function e(r){var t,o;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n(r);case 3:if(!n.errors){e.next=7;break}throw(t=new Error).errors=n.errors,t;case 7:return e.abrupt("return",null);case 10:if(e.prev=10,e.t0=e.catch(0),!(o=e.t0.errors)){e.next=17;break}return e.abrupt("return",(s=o,F()(s).call(s,(function(e,n){var r=n.params,t=n.keyword,o=n.instancePath,s=n.message;if(o){var i=a()(o).call(o,1);e.hasOwnProperty(i)?e[i]+=",".concat(s):e[i]=s}else if("errorMessage"===t){var c=r.errors,l=c[0].keyword;if("required"===l||"dependentRequired"===l){var u,d=oe(c);try{for(d.s();!(u=d.n()).done;){e[u.value.params.missingProperty]=s}}catch(e){d.e(e)}finally{d.f()}}else"minProperties"===l&&(e.all=s)}return e}),{})));case 17:throw e.t0;case 18:case"end":return e.stop()}var s}),e,null,[[0,10]])})));return function(n){return e.apply(this,arguments)}}()}function de(){return(de=(0,p.Z)(h().mark((function e(n,r,t,a){var o,s,i,c,l,u;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",!0);case 2:return o={origin_password:r},e.next=5,re.post(ce.API.PASSWORD,o);case 5:if(s=e.sent,i=s.errno,c=s.msg,!i){e.next=13;break}throw l=a.instancePath,(u=new Error).errors=[{instancePath:l,message:c}],u;case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fe(){return(fe=(0,p.Z)(h().mark((function e(n,r,t,a){var o,s,i,c,l,u,d;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",!0);case 2:return o="email",e.next=5,re.post("/api/user/isEmailExist",(0,U.Z)({},o,r));case 5:if(s=e.sent,i=s.errno,c=s.msg,!i){e.next=14;break}throw l=a.instancePath,u=new Error,d=c[o],u.errors=[{instancePath:l,message:d}],u;case 14:return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}ie.addSchema(le[ce.VALIDATE.DEFS]);const me=(ae={},(0,U.Z)(ae,ce.VALIDATE.EMAIL,ue(ce.VALIDATE.EMAIL)),(0,U.Z)(ae,ce.VALIDATE.REGISTER,ue(ce.VALIDATE.REGISTER)),(0,U.Z)(ae,ce.VALIDATE.LOGIN,ue(ce.VALIDATE.LOGIN)),(0,U.Z)(ae,ce.VALIDATE.PASSWORD,ue(ce.VALIDATE.PASSWORD)),(0,U.Z)(ae,ce.VALIDATE.AVATAR,ue(ce.VALIDATE.AVATAR)),(0,U.Z)(ae,ce.VALIDATE.SETTING,ue(ce.VALIDATE.SETTING)),ae);var pe=r(29089),ge=r.n(pe);function he(e,n){var r=void 0!==c()&&u()(e)||e["@@iterator"];if(!r){if(f()(e)||(r=function(e,n){var r;if(e){if("string"==typeof e)return ve(e,n);var t=a()(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?s()(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?ve(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){d=!0,i=e},f:function(){try{l||null==r.return||r.return()}finally{if(d)throw i}}}}function ve(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}console.log("@initData loading....");var we=function(){function e(){(0,I.Z)(this,e),(0,U.Z)(this,"data",{}),(0,U.Z)(this,"promises",[])}var n,r;return(0,T.Z)(e,[{key:"addOtherInitFn",value:(r=(0,p.Z)(h().mark((function e(n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.promises.push(n());case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"render",value:(n=(0,p.Z)(h().mark((function e(n){var r,t,a,o,s;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z().all(this.promises);case 2:r=e.sent,t=he(r),e.prev=4,t.s();case 6:if((a=t.n()).done){e.next=18;break}o=a.value,e.t0=ge()(h()).call(h(),o);case 9:if((e.t1=e.t0()).done){e.next=16;break}if("news"!==(s=e.t1.value)){e.next=13;break}return e.abrupt("continue",9);case 13:this.data[s]=o[s],e.next=9;break;case 16:e.next=6;break;case 18:e.next=23;break;case 20:e.prev=20,e.t2=e.catch(4),t.e(e.t2);case 23:return e.prev=23,t.f(),e.finish(23);case 26:if(!n){e.next=29;break}return e.next=29,n(this.data);case 29:case"end":return e.stop()}}),e,this,[[4,20,23,26]])}))),function(e){return n.apply(this,arguments)})}]),e}(),Ee=r(91994),Re=r.n(Ee),be=r(56908),ye=r.n(be),Ae=r(55125),xe=r.n(Ae),Oe=r(59225),_e=r.n(Oe),Ie=r(51313),Te=r.n(Ie),Le=r(86829),ke=r.n(Le),De=r(86828),Se=r.n(De),Me=r(54740),Ne=r.n(Me),$e=r(52532),Ce=r.n($e),je=r(81906),Pe=r(47555),Ze=r(18018),Ge=r(65638);function Ue(){Ue=function(e,n){return new r(e,void 0,n)};var e=RegExp.prototype,n=new(Se());function r(e,t,a){var o=new RegExp(e,t);return n.set(o,a||n.get(e)),(0,Ze.Z)(o,r.prototype)}function t(e,r){var t,a=n.get(r);return F()(t=Re()(a)).call(t,(function(n,r){var t=a[r];if("number"==typeof t)n[r]=e[t];else{for(var o=0;void 0===e[t[o]]&&o+1<t.length;)o++;n[r]=e[t[o]]}return n}),Ne()(null))}return(0,Pe.Z)(r,RegExp),r.prototype.exec=function(n){var r=e.exec.call(this,n);if(r){r.groups=t(r,this);var a=r.indices;a&&(a.groups=t(a,this))}return r},r.prototype[Ce()]=function(r,o){if("string"==typeof o){var s=n.get(this);return e[Ce()].call(this,r,o.replace(/\$<([^>]+)>/g,(function(e,n){var r=s[n];return"$"+(f()(r)?r.join("$"):r)})))}if("function"==typeof o){var i=this;return e[Ce()].call(this,r,(function(){var e=arguments;return"object"!=(0,je.Z)(e[e.length-1])&&(e=a()([]).call(e)).push(t(e,i)),o.apply(this,e)}))}return e[Ce()].call(this,r,o)},Ue.apply(this,arguments)}function Be(e,n){var r=Re()(e);if(ye()){var t=ye()(e);n&&(t=y()(t).call(t,(function(n){return xe()(e,n).enumerable}))),r.push.apply(r,t)}return r}function Fe(e){for(var n=1;n<arguments.length;n++){var r,t,a=null!=arguments[n]?arguments[n]:{};n%2?k()(r=Be(Object(a),!0)).call(r,(function(n){(0,U.Z)(e,n,a[n])})):_e()?Te()(e,_e()(a)):k()(t=Be(Object(a))).call(t,(function(n){ke()(e,n,xe()(a,n))}))}return e}function Ve(e,n){var r=void 0!==c()&&u()(e)||e["@@iterator"];if(!r){if(f()(e)||(r=function(e,n){var r;if(e){if("string"==typeof e)return We(e,n);var t=a()(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?s()(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?We(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){d=!0,i=e},f:function(){try{l||null==r.return||r.return()}finally{if(d)throw i}}}}function We(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function qe(){return Xe.apply(this,arguments)}function Xe(){return Xe=(0,p.Z)(h().mark((function e(){var n,r,t,o,s,i,c,l,u;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=function(){return(u=(0,p.Z)(h().mark((function e(n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re.post("/api/news",n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)},l=function(e){return u.apply(this,arguments)},c=function(){var e=Ue(/^\/(\w+)\/?(list)?/,{pathname:1,albumList:2}).exec(location.pathname).groups,n=e.pathname;e.albumList,console.log("@pathname => ",n),Ge('.nav-link[href^="/'.concat(n,'"]')).addClass("active")},i=function(){Ge(".navbar").removeClass("navbar-expand-sm").addClass("navbar-expand"),Ge(".nav").removeClass("order-0 order-md-0").addClass("order-1"),Ge(".offcanvas").removeClass("order-1 order-md-1").addClass("order-0"),Ge(".navbar-toggler, .offcanvas").remove()},s=function(e){var n=Ge("#readMore"),r=Ge("#noNews"),t=Ge(".news-count"),o=Ge("#newsDropdown"),s={me:e.me,news:{newsDropdownOpen:!1,readMoring:{_value:!1,get status(){return this._value},set status(e){this._value=e,n.children("button").prop("disabled",e)}},htmlStr:{confirm:"",unconfirm:""},newsList:{confirm:[],unconfirm:[]},excepts:{idolFans:[],articleReader:[],msgReceiver:[],get num(){return this.idolFans.length+this.articleReader.length+this.msgReceiver.length}},num:{newsList:{get unconfirm(){return d.unconfirm.length},get confirm(){return d.confirm.length},get total(){return this.confirm+this.unconfirm}},db:{confirm:0,unconfirm:0,total:0},unRender:{confirm:0,unconfirm:0,get total(){return this.confirm+this.unconfirm},clear:function(){this.confirm=0,this.unconfirm=0}},rendered:{confirm:0,unconfirm:0,get total(){return this.confirm+this.unconfirm},clear:function(){this.confirm=0,this.unconfirm=0}}},fn:{listTotal:function(e){return e.confirm.length+e.unconfirm.length},itemIsExist:function(e){return!!e.confirm||!!e.unconfirm},excepts:{clear:function(){for(var e in f)"num"!==e&&(f[e]=[])},update:function(e){var n,r=Ve(e);try{for(r.s();!(n=r.n()).done;){var t=n.value,a=t.type,o=t.id;f[1===a?"idolFans":2===a?"articleReader":"msgReceiver"].push(o)}}catch(e){r.e(e)}finally{r.f()}}},newsList:{clear:function(){for(var e in d)d[e]=[];v.excepts.clear()},update:function(e){var n=e.newsList,r=e.num;if(g.db=r,v.listTotal(n))for(var t in n){var a,o=n[t];d[t]=C()(a=[]).call(a,(0,m.Z)(d[t]),(0,m.Z)(o)),v.excepts.update(o)}},reset:function(e){this.clear(),this.update(e)}},htmlStr:{_template:function(e){var n=this._gen,r=n.idolFans,t=n.articleReader,a=n.msgReceiver;return F()(e).call(e,(function(e,n){var o=n.type,s=n.confirm?'<li data-my-hr="confirm-news-hr">':'<li data-my-hr="unconfirm-news-hr">';return(e+=1===o?r(n):2===o?t(n):a(n))+(s+'<hr class="dropdown-divider"></li>')}),"")},_gen:{idolFans:function(e){var n,r,t,a=e.confirm,o=e.id,s=e.fans,i=e.timestamp,c=a?"":"?type=1&id=".concat(o);return C()(n=C()(r=C()(t='\n                                        \x3c!-- 新通知 of fans --\x3e\n                                        <li class="dropdown-item position-relative news-item">\n                                            <a href="/other/'.concat(s.id)).call(t,c,'" class="stretched-link text-wrap ">\n                                                <div>\n                                                    <span>')).call(r,s.nickname,"追蹤你囉！</span><br>\n                                                    <span class='text-end mb-0'>")).call(n,i,"</span>\n                                                </div>\n                                            </a>\n                                        </li>")},articleReader:function(e){var n,r,t,a,o=e.confirm,s=e.id,i=e.blog,c=e.timestamp,l=o?"":"?type=2&id=".concat(s);return C()(n=C()(r=C()(t=C()(a='\n                                        <li class="dropdown-item  position-relative news-item">\n                                            <a href="/blog/'.concat(i.id)).call(a,l,'" class="stretched-link text-wrap">\n                                                <div>\n                                                    <span>')).call(t,i.author.nickname," 有新文章唷！</span><br>\n                                                    <span>- ")).call(r,i.title,"-</span><br>\n                                                    <span class='text-end mb-0'>")).call(n,c,"</span>\n                                                </div>\n                                            </a>\n                                        </li>")},msgReceiver:function(e){var n,r,t,o,i,c,l,u=e.confirm,d=e.id,f=e.comment,m=e.timestamp,p=u?"":"?type=3&id=".concat(d),g=f.otherComments,h=g.commenters.length,v=R()(n=g.commenters).call(n,(function(e){return e.nickname})),w=f.commenter.nickname+h>1?a()(v).call(v,0,2).join(",")+(h>2?"與其他".concat(h-2,"人"):"，都"):1===h?v[0]:f.commenter.nickname,E=f.article.author.id===s.me.id?"你":f.article.author.id===f.commenter.id?"自己":f.blog.author.nickname;return C()(r=C()(t=C()(o=C()(i=C()(c=C()(l='\n                                        <li class="dropdown-item  position-relative news-item">\n                                            <a href="/blog/'.concat(f.article.id)).call(l,p,"#comment_")).call(c,f.id,'" class="stretched-link text-wrap">\n                                                <div>\n                                                    <span>')).call(i,w,"在")).call(o,E,"的文章「")).call(t,f.article.title,"」留言囉！</span><br>\n                                                    <span class='text-end mb-0'>")).call(r,m,"</span>\n                                                </div>\n                                            </a>\n                                        </li>")}},clear:function(){for(var e in g.unRender.clear(),u)u[e]=""},update:function(e){var n=e||d;if(v.listTotal(n))for(var r in n){var t=this._template(n[r]);u[r]+=t,g.unRender[r]+=n[r].length}},reset:function(e){this.clear(),this.update(e)}},newsDropdown:{clear:function(){Ge(".news-item").remove(),Ge("[data-my-hr]").remove(),g.rendered.clear()},insert:function(){if(g.unRender.total){var e=g.unRender.total&&!g.rendered.total;for(var t in u){var a=u[t],o=Ge("#".concat(t,"-news-title"));if(a){o.is(":hidden")&&show(o);var s=Ge("[data-my-hr=".concat(t,"-news-hr]"));s.length?s.last().after(a):o.after(a),g.rendered[t]+=g.unRender[t]}else e&&show(o,!1)}var i=g.db.total-g.rendered.total;show(n,i),show(r,!i),v.htmlStr.clear()}}}}}},i=s.news,c=i.readMoring,u=i.htmlStr,d=i.newsList,f=i.excepts,g=i.num,v=i.fn,w=G((function(){return b.apply(this,arguments)}),{auto:!0,ms:3e5});function E(){return E=(0,p.Z)(h().mark((function e(n){var r,t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(confirm("真的要登出?")){e.next=4;break}return alert("對嘛，再待一下嘛"),e.abrupt("return");case 4:return e.next=6,re.get("/api/user/logout");case 6:r=e.sent,t=r.data,alert(t),location.href="/login";case 10:case"end":return e.stop()}}),e)}))),E.apply(this,arguments)}function b(){return(b=(0,p.Z)(h().mark((function e(){var n,r,a,o,s,u;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.status&&!i.newsDropdownOpen){e.next=2;break}return e.abrupt("return");case 2:return c.status=!0,n=Fe({},f),e.next=6,l({excepts:n});case 6:return r=e.sent,a=r.data.news,o=a.hasNews,s=a.newsList,o&&(v.newsList.clear(),v.htmlStr.clear(),v.newsDropdown.clear()),v.newsList.update(a),v.htmlStr.update(s),u=g.db.unconfirm-g.rendered.unconfirm,show(t,u).text(u||""),c.status=!1,console.log("@auto readMore OK..."),e.abrupt("return");case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=(0,p.Z)(h().mark((function e(){var n,r,a,o,s;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.status=!0,n=Fe({},f),e.next=4,l({excepts:n});case 4:r=e.sent,a=r.data.news,o=a.newsList,a.hasNews&&(v.newsDropdown.clear(),v.newsList.clear(),v.htmlStr.clear()),v.newsList.update(a),v.htmlStr.update(o),v.newsDropdown.insert(),s=g.db.unconfirm-g.rendered.unconfirm,show(t,s).text(s||""),c.status=!1;case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}v.newsList.reset(e.news),v.htmlStr.update(),show(t,g.db.unconfirm).text(g.db.unconfirm||""),o.on("show.bs.dropdown",(function(){i.newsDropdownOpen=!0})),o.on("hide.bs.dropdown",(function(){i.newsDropdownOpen=!1})),o.click((function(){g.unRender.total&&v.newsDropdown.insert();var e=g.db.unconfirm-g.rendered.unconfirm;show(t,e).text(e||"")})),n.click((function(){return y.apply(this,arguments)})),Ge("#logout").click((function(e){return E.apply(this,arguments)})),w()},o=function(e){var n,r=C()(n='\n                        <ul class="navbar-nav justify-content-around">\n                            <li class="nav-item">\n                                <a class="nav-link" href="/self">個人頁面</a>\n                            </li>\n                            <li class="nav-item">\n                                <a class="nav-link" href="/album/list?owner_id='.concat(e,'">文章相簿</a>\n                            </li>\n                            <li class="nav-item">\n                                <a class="nav-link" href="/setting?owner_id=')).call(n,e,'">個人設置</a>\n                            </li>\n                            <li class="nav-item">\n                                <a id="logout" class="btn btn-outline-success text-nowrap">登出</a>\n                            </li>\n                        </ul>\n                        ');return Ge("#needCollapse-list").html(r),Ge("#noNeedCollapse-list").html('\n                        <li class="nav-item d-none d-sm-inline-block">\n                            <a class="nav-link" href="/square">廣場頁</a>\n                        </li>\n                        \x3c!--純粹用作排版--\x3e\n                        <li style="flex-grow: 1;">\n                        </li> \n                        \x3c!--下拉選單--\x3e\n                        <li class="nav-item dropdown">\n                            <a class="nav-link dropdown-toggle" href="#" id="newsDropdown"\n                                role="button" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">通知\n                                <span class="position-absolute translate-middle badge rounded-pill bg-danger news-count"></span>\n                            </a>\n                            \x3c!-- 通知列表 --\x3e\n                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown" id="newList">\n                                \x3c!-- 新通知標題 --\x3e\n                                <li class="dropdown-item" id="unconfirm-news-title">新通知</li>\n                                \x3c!-- 先前通知的標頭 --\x3e\n                                <li class="dropdown-item" id="confirm-news-title">先前的通知</li>\n                                <li id="readMore">\n                                    <button class="dropdown-item link-primary" type="button">讀取更多</button>\n                                </li>\n                                <li class="dropdown-item" id="noNews">\n                                    <span>沒有更多了</span>\n                                </li>\n                            </ul>\n                        </li>\n                        '),!0},e.next=8,l();case 8:return n=e.sent,r=n.errno,t=n.data,c(),r?i():(o(t.me.id),s(t)),e.abrupt("return",t);case 13:case"end":return e.stop()}}),e)}))),Xe.apply(this,arguments)}console.log("@navbar loading...");var He=r(64925),Je=r.n(He),Ke=r(65638);function ze(){ze=function(e,n){return new r(e,void 0,n)};var e=RegExp.prototype,n=new(Se());function r(e,t,a){var o=new RegExp(e,t);return n.set(o,a||n.get(e)),(0,Ze.Z)(o,r.prototype)}function t(e,r){var t,a=n.get(r);return F()(t=Re()(a)).call(t,(function(n,r){var t=a[r];if("number"==typeof t)n[r]=e[t];else{for(var o=0;void 0===e[t[o]]&&o+1<t.length;)o++;n[r]=e[t[o]]}return n}),Ne()(null))}return(0,Pe.Z)(r,RegExp),r.prototype.exec=function(n){var r=e.exec.call(this,n);if(r){r.groups=t(r,this);var a=r.indices;a&&(a.groups=t(a,this))}return r},r.prototype[Ce()]=function(r,o){if("string"==typeof o){var s=n.get(this);return e[Ce()].call(this,r,o.replace(/\$<([^>]+)>/g,(function(e,n){var r=s[n];return"$"+(f()(r)?r.join("$"):r)})))}if("function"==typeof o){var i=this;return e[Ce()].call(this,r,(function(){var e=arguments;return"object"!=(0,je.Z)(e[e.length-1])&&(e=a()([]).call(e)).push(t(e,i)),o.apply(this,e)}))}return e[Ce()].call(this,r,o)},ze.apply(this,arguments)}function Qe(e,n){var r=Re()(e);if(ye()){var t=ye()(e);n&&(t=y()(t).call(t,(function(n){return xe()(e,n).enumerable}))),r.push.apply(r,t)}return r}function Ye(e){for(var n=1;n<arguments.length;n++){var r,t,a=null!=arguments[n]?arguments[n]:{};n%2?k()(r=Qe(Object(a),!0)).call(r,(function(n){(0,U.Z)(e,n,a[n])})):_e()?Te()(e,_e()(a)):k()(t=Qe(Object(a))).call(t,(function(n){ke()(e,n,xe()(a,n))}))}return e}function en(){return nn.apply(this,arguments)}function nn(){return nn=(0,p.Z)(h().mark((function e(){var n,r,t,a,o,s;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(e){var n=new(Je());return k()(e).call(e,(function(e){n.set(e.alt_id,Ye({},e))})),n},o=function(){return o=(0,p.Z)(h().mark((function e(n){var r,t,a,o,i,c,l,u,d,f;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=function(e){return F()(e).call(e,(function(e,n){var r=e.map_commentId,t=e.map_commentPid;return function e(n){var a,o=n.id,s=n.p_id,i=n.reply;r.set(o,n);var c=t.get(s)||[];return t.set(s,C()(a=[]).call(a,(0,m.Z)(c),[n])),i.length?k()(i).call(i,(function(n){return e(n)})):t.set(o,[]),{map_commentId:r,map_commentPid:t}}(n)}),{map_commentId:new(Je()),map_commentPid:(new(Je())).set(0,[])})},d=function(e){if(!e||"null"===e||"undefined"===e)return"";for(var n,t=decodeURI(e),a=ze(/<x\x2Dimg.+?data\x2Dalt\x2Did='(\w+?)'.+?(data\x2Dstyle='(.+?)')?.*?\/>/g,{alt_id:1,style:3}),o=t;n=a.exec(t);){var s,i,c,l,u,d=n.groups,f=d.alt_id,m=d.style,p=r.map_imgs.get(1*f),g=p.url,h=p.alt,v=m?C()(s=C()(i=C()(c="<img src='".concat(g,"?alt_id=")).call(c,f,"' alt='")).call(i,h,"' style='")).call(s,m,"' />"):C()(l=C()(u="<img src='".concat(g,"?alt_id=")).call(u,f,"' alt='")).call(l,h,"' />");o=o.replace(n[0],v)}return o},(r=JSON.parse(n)).map_imgs=s(r.imgs),r.html=d(r.html),t=/^\/blog\/edit\/\d+/.test(location.pathname),a=/\?preview=true/.test(location.search),console.log("@isBlogEditPage 判斷是否為 編輯頁 => ",t),console.log("@isBlogPreview 判對是否為 預覽頁 => ",a),console.log("@若是編輯頁或預覽頁 => 不需請求 comment"),t||a){e.next=23;break}return e.next=15,re.get("/api/comment/".concat(r.id));case 15:if(o=e.sent,i=o.errno,c=o.data,!i){e.next=21;break}return alert("ERR"),e.abrupt("return");case 21:l=c.comments,u=c.commentsHtmlStr,r=Ye(Ye({},r),{},{comments:l,commentsHtmlStr:u},f(l));case 23:return e.abrupt("return",r);case 24:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)},a=function(e){return o.apply(this,arguments)},t=function(e){var n=JSON.parse(e),r=n.blog,t=n.imgs;return{blog:r,imgs:t,map_imgs:s(t)}},n=[],Ke("[data-my-data]").each((function(e,r){return n.push(r)})),e.next=8,F()(n).call(n,function(){var e=(0,p.Z)(h().mark((function e(n,r){var o,s,i,c;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=Ke(r).data("my-data"),e.prev=1,i=Ke(r).html(),"blog"!==o){e.next=10;break}return e.next=6,a(i);case 6:e.t0=e.sent,s={blog:e.t0},e.next=18;break;case 10:if("album"!==o){e.next=17;break}return e.next=13,t(i);case 13:e.t1=e.sent,s={album:e.t1},e.next=18;break;case 17:s=(0,U.Z)({},o,JSON.parse(i));case 18:return e.next=20,n;case 20:return c=e.sent,e.abrupt("return",Ye(Ye({},c),s));case 24:throw e.prev=24,e.t2=e.catch(1),e.t2;case 27:case"end":return e.stop()}}),e,null,[[1,24]])})));return function(n,r){return e.apply(this,arguments)}}(),{});case 8:return r=e.sent,Ke("[data-my-data]").parent().remove(),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)}))),nn.apply(this,arguments)}console.log("@initEJSData loading....");var rn=r(65638);function tn(e,n){var r=void 0!==c()&&u()(e)||e["@@iterator"];if(!r){if(f()(e)||(r=function(e,n){var r;if(e){if("string"==typeof e)return an(e,n);var t=a()(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?s()(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?an(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){d=!0,i=e},f:function(){try{l||null==r.return||r.return()}finally{if(d)throw i}}}}function an(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}window.addEventListener("load",(0,p.Z)(h().mark((function e(){var n,r,t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){var e,n,r,t,a=me,o={login:{},register:{}};function s(){return(s=(0,p.Z)(h().mark((function e(n){var r,t,s,i,l,u,d;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.target,t=rn(r).parents("form")[0],s=t.dataset.myType,i=o[s],l=r.value,i.email=l,e.next=8,a.email(i);case 8:if(!(u=e.sent)){e.next=13;break}return d=u.email,c(r,!1,d),e.abrupt("return");case 13:c(r,!0,""),r.focus();case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function i(e){return function(){var n=(0,p.Z)(h().mark((function n(t){var s,i,l,u,d,f,p,g,v,E,b,A,O,I,T,L,k,D,S,M,N,$,C,j,P,Z,U,B,F,V,W,q,X,H,J,K,z,Q,Y,ee,ne,te;return h().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.preventDefault(),s=t.target,i=e.FORM,l=e.API,u=document.querySelector("form[data-my-type=".concat(i,"]")),f=o[i],p=[],g=[],v=a[i],"input"!==t.type){n.next=13;break}f[s.name]=s.value,n.next=34;break;case 13:(d=w()(E=rn(u)).call(E,"button[type=submit]")[0]).disabled=!0,console.log("@btn_submit 狀態 1 => ",d),b=tn(u),n.prev=17,b.s();case 19:if((A=b.n()).done){n.next=26;break}if("submit"!==(O=A.value).type&&("register"!==i||"email"!==O.name)){n.next=23;break}return n.abrupt("continue",24);case 23:f[O.name]=O.value;case 24:n.next=19;break;case 26:n.next=31;break;case 28:n.prev=28,n.t0=n.catch(17),b.e(n.t0);case 31:return n.prev=31,b.f(),n.finish(31);case 34:return n.next=36,v(f);case 36:if(I=n.sent,"input"!==t.type){n.next=59;break}T=tn(u),n.prev=39,T.s();case 41:if((L=T.n()).done){n.next=49;break}if(k=L.value,D=k.name,"submit"!==k.type&&("register"!==i||"email"!==D)){n.next=46;break}return n.abrupt("continue",47);case 46:I&&I[D]?I[D]&&p.push({inp:k,msg:I[D]}):g.push(k);case 47:n.next=41;break;case 49:n.next=54;break;case 51:n.prev=51,n.t1=n.catch(39),T.e(n.t1);case 54:return n.prev=54,T.f(),n.finish(54);case 57:n.next=74;break;case 59:if(!I){n.next=67;break}for(C in N=R()(S=y()(M=(0,m.Z)(u)).call(M,(function(e){return"submit"!==e.type&&!("register"===i&&"email"===e.name)}))).call(S,(function(e){return e.name})),$=new(x())(N),I)$.delete(C),P=w()(j=rn(u)).call(j,"input[name=".concat(C,"]"))[0],p.push({inp:P,msg:I[C]});Z=tn($);try{for(Z.s();!(U=Z.n()).done;)F=U.value,V=w()(B=rn(u)).call(B,"input[name=".concat(F,"]"))[0],g.push(V)}catch(e){Z.e(e)}finally{Z.f()}n.next=74;break;case 67:return n.next=69,re.post(l,f);case 69:return W=n.sent,q=W.errno,X=W.msg,q?(alert(X),rn(u)[0].reset(),f={},c(!1),d.disabled=!1,console.log("@btn_submit 狀態 2 => ",d)):"login"===i?(alert("登入成功"),H=!!location.search&&new(_())(location.search).get("from"),location.href=H||"/self"):(alert("註冊成功，請嘗試登入"),location.pathname="/login"),n.abrupt("return");case 74:for(J=0,K=g;J<K.length;J++)c(K[J],!0,"");for(z=0,Q=p;z<Q.length;z++)Y=Q[z],ee=Y.inp,ne=Y.msg,c(ee,!1,ne),te=G(r,{loading:function(e){c(e.target,"load")}}),ee.removeEventListener("input",te),ee.addEventListener("input",r);return d&&(d.disabled=!1,console.log("@btn_submit 狀態 3 => ",d)),n.abrupt("return");case 78:case"end":return n.stop()}}),n,null,[[17,28,31,34],[39,51,54,57]])})));function r(e){return n.apply(this,arguments)}return r}()}function c(e,n,r){if(!1===e){var t,a=tn(rn("form"));try{for(a.s();!(t=a.n()).done;){var o,s=tn(t.value);try{for(s.s();!(o=s.n()).done;){var i=o.value;rn(i).removeClass("is-invalid is-valid"),rn(i).next().removeClass("invalid-feedback valid-feedback myshow").text("")}}catch(e){s.e(e)}finally{s.f()}}}catch(e){a.e(e)}finally{a.f()}}else"load"===n?rn(e).next().toggleClass("my-show",!0).text("loading..."):n?(rn(e).removeClass("is-invalid").addClass("is-valid"),rn(e).next().removeClass("invalid-feedback myshow").addClass("valid-feedback").text(r)):(rn(e).removeClass("is-valid").addClass("is-invalid"),rn(e).next().removeClass("valid-feedback myshow").addClass("invalid-feedback").text(r))}n=rn("form[data-my-type=register] input[name=email]"),r=function(e){return s.apply(this,arguments)},t=G(r,{loading:function(e){c(e.target,"load")}}),n.on("input",t),console.log("@ => ",w()(e=rn("form[data-my-type=login]")).call(e,"button")),document.querySelector("form[data-my-type=register]").addEventListener("submit",i({FORM:"register",API:"/api/user/register"})),rn("form[data-my-type=login]").on("submit",i({FORM:"login",API:"/api/user"}))},console.log("-------------------------------------\x3e onload ... start"),e.prev=2,console.log("loading start -----"),(n=new N).show(),r=new we,e.next=9,r.addOtherInitFn(en);case 9:return e.next=11,r.addOtherInitFn(qe);case 11:return e.next=13,r.render(t);case 13:n.hidden(),rn("main, nav").removeAttr("style"),e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(2),e.t0;case 20:case 21:case"end":return e.stop()}}),e,null,[[2,17]])}))))}},e=>{e.O(0,[216],(()=>(46997,e(e.s=46997)))),e.O()}]);